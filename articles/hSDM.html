<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to hSDM • hSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to hSDM">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/publications.html">Publications</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://twitter.com/ghislainv">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/ghislainv/hSDM">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to hSDM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/hSDM/blob/master/vignettes/hSDM.Rmd"><code>vignettes/hSDM.Rmd</code></a></small>
      <div class="hidden name"><code>hSDM.Rmd</code></div>

    </div>

    
    
<p>Species distribution models (SDM) are useful tools to explain or predict species range and abundance from various environmental factors. SDM are thus widely used in conservation biology. When using field observations (occurence or abundance data) to fit SDMs, two major problems can arise leading to potential bias in models’ results: imperfect detection <span class="citation">(Lahoz-Monfort, Guillera-Arroita &amp; Wintle <a href="#ref-Lahoz-Monfort2014">2014</a>)</span> and spatial dependence of the observations <span class="citation">(Lichstein <em>et al.</em> <a href="#ref-Lichstein2002">2002</a>)</span>. In this vignette, we illustrate the use of the <code>hSDM</code> R package wich aims at providing user-friendly statistical functions to account for both imperfect detection and spatial dependence. Package’s functions are developped in a hierarchical Bayesian framework. Functions call a Metropolis-within-Gibbs algorithm coded in C to estimate model’s parameters. Using compiled C code for the Gibbs sampler reduce drastically the computation time. By making these new statistical tools available to the scientific community, we hope to democratize the use of more complex, but more realistic, statistical models for increasing knowledge in ecology and conserving biodiversity.</p>
<p>Below, we show an example of the use of <code>hSDM</code> for fitting a species distribution model to abundance data for a bird species. Model types available in <code>hSDM</code> are not limited to those described in this example. <code>hSDM</code> includes various model types (for various contexts: imperfect detection, spatial dependence, zero-inflation, land transformation) for both occurrence and abundance data:</p>
<ul>
<li>simple Binomial and Poisson models <span class="citation">(Clark <a href="#ref-Clark2007">2007</a>)</span>
</li>
<li>site-occupancy models <span class="citation">(MacKenzie <em>et al.</em> <a href="#ref-MacKenzie2002">2002</a>)</span>
</li>
<li>N-mixture models <span class="citation">(Royle <a href="#ref-Royle2004">2004</a>)</span>
</li>
<li>Zero-Inflated Binomial (ZIB) models <span class="citation">(Wilson &amp; Jetz <a href="#ref-Wilson2016">2016</a>)</span>
</li>
<li>Zero-Inflated Poisson (ZIP) models <span class="citation">(Flores, Rossi &amp; Mortier <a href="#ref-Flores2009">2009</a>)</span>
</li>
<li>less common mixture models to account for land degradation <span class="citation">(Latimer <em>et al.</em> <a href="#ref-Latimer2006">2006</a>)</span>
</li>
</ul>
<p>All the above models can include an additional intrinsic conditional autoregressive (iCAR) process to account for the spatial dependence of the observations. It should be easy for the user to fit other model types from the example below as function arguments are rather similar from one model to the other.</p>
<div id="data-set" class="section level1">
<h1 class="hasAnchor">
<a href="#data-set" class="anchor"></a><span class="header-section-number">1</span> Data-set</h1>
<p>The data-set from <span class="citation">Kéry &amp; Andrew Royle (<a href="#ref-Kery2010b">2010</a>)</span> includes repeated count data for the Willow tit (<em>Poecile montanus</em>, a pesserine bird, Fig. <a href="#fig:Willow-tit">1.1</a>) in Switzerland on the period 1999-2003. Data come from the Swiss national breeding bird survey MHB (Monitoring Haüfige Brutvögel). MHB is based on 264 1-km<span class="math inline">\(^2\)</span> sampling units (quadrats) laid out as a grid (Fig. <a href="#fig:sites">1.2</a>). Since 1999, every quadrat has been surveyed two to three times during most breeding seasons (15 April to 15 July). The Willow tit is a widespread but moderately rare bird species. It has a weak song and elusive behaviour and can be rather difficult to detect.</p>

<div class="figure" style="text-align: center">
<span id="fig:Willow-tit"></span>
<img src="figures/Poecile_montanus.jpg" alt="Willow tit (Poecile montanus)." width="\textwidth"><p class="caption">
Figure 1.1: <strong>Willow tit (<em>Poecile montanus</em>).</strong>
</p>
</div>
<p>We first load some necessary packages. The <code>sp</code> and <code>raster</code> packages will be used for manipulating spatial data.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load libraries</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sp)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(raster)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(hSDM)
<span class="co">#&gt; ##</span>
<span class="co">#&gt; ## hSDM R package </span>
<span class="co">#&gt; ## For hierarchical Bayesian species distribution models </span>
<span class="co">#&gt; ##</span></code></pre>
<p>This data-set from <span class="citation">Kéry &amp; Andrew Royle (<a href="#ref-Kery2010b">2010</a>)</span> is available in the <code>hSDM</code> R package. It can be loaded with the <code>data</code> command and formated to be used with <code>hSDM</code> functions. The data is in “wide” format: each line is a site and the repeated count data (from count1 to count3) are in columns. A site is characterized by its x-y geographical coordinates, elevation (in m) and forest cover (in %). The date of each observation (julian date) has been recorded.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load Kéry et al. 2010 data</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(data.Kery2010, <span class="dt">package=</span><span class="st">"hSDM"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/headtail">head</a></span>(data.Kery2010)
<span class="co">#&gt;   coordx coordy elevation forest count1 count2 count3 juldate1 juldate2</span>
<span class="co">#&gt; 1    497    118       450      3      0      0      0      114      139</span>
<span class="co">#&gt; 2    503    134       450     21      0      0      0      108      130</span>
<span class="co">#&gt; 3    503    158      1050     32      1      1      0      116      145</span>
<span class="co">#&gt; 4    509    166      1150     35      0      0      0      106      134</span>
<span class="co">#&gt; 5    509    150       950     NA      0      0      0      121      152</span>
<span class="co">#&gt; 6    521    150       550      2      0      0      0      114      141</span>
<span class="co">#&gt;   juldate3</span>
<span class="co">#&gt; 1      166</span>
<span class="co">#&gt; 2      158</span>
<span class="co">#&gt; 3      177</span>
<span class="co">#&gt; 4      160</span>
<span class="co">#&gt; 5      166</span>
<span class="co">#&gt; 6      150</span></code></pre>
<p>We first normalize the data to facilitate MCMC convergence. We discard the forest cover in our example.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Normalized variables</span>
elev.mean &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(data.Kery2010<span class="op">$</span>elevation)
elev.sd &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(data.Kery2010<span class="op">$</span>elevation)
juldate.mean &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(data.Kery2010<span class="op">$</span>juldate1,
                     data.Kery2010<span class="op">$</span>juldate2,
                     data.Kery2010<span class="op">$</span>juldate3),<span class="dt">na.rm=</span><span class="ot">TRUE</span>)
juldate.sd &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/sd">sd</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(data.Kery2010<span class="op">$</span>juldate1,
                 data.Kery2010<span class="op">$</span>juldate2,
                 data.Kery2010<span class="op">$</span>juldate3),<span class="dt">na.rm=</span><span class="ot">TRUE</span>)
data.Kery2010<span class="op">$</span>elevation &lt;-<span class="st"> </span>(data.Kery2010<span class="op">$</span>elevation<span class="op">-</span>elev.mean)<span class="op">/</span>elev.sd
data.Kery2010<span class="op">$</span>juldate1 &lt;-<span class="st"> </span>(data.Kery2010<span class="op">$</span>juldate1<span class="op">-</span>juldate.mean)<span class="op">/</span>juldate.sd
data.Kery2010<span class="op">$</span>juldate2 &lt;-<span class="st"> </span>(data.Kery2010<span class="op">$</span>juldate2<span class="op">-</span>juldate.mean)<span class="op">/</span>juldate.sd
data.Kery2010<span class="op">$</span>juldate3 &lt;-<span class="st"> </span>(data.Kery2010<span class="op">$</span>juldate3<span class="op">-</span>juldate.mean)<span class="op">/</span>juldate.sd</code></pre>
<p>We plot the observation sites over a grid of 10 <span class="math inline">\(\times\)</span> 10 km<span class="math inline">\(^2\)</span> cells.</p>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Landscape and observation sites</span>
sites.sp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/SpatialPoints">SpatialPointsDataFrame</a></span>(<span class="dt">coords=</span>data.Kery2010[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"coordx"</span>,<span class="st">"coordy"</span>)],
                                   <span class="dt">data=</span>data.Kery2010[,<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>)])
xmin &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(data.Kery2010<span class="op">$</span>coordx)
xmax &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(data.Kery2010<span class="op">$</span>coordx)
ymin &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(data.Kery2010<span class="op">$</span>coordy)
ymax &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(data.Kery2010<span class="op">$</span>coordy)
res_spatial_cell &lt;-<span class="st"> </span><span class="dv">10</span>
ncol &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">ceiling</a></span>((xmax<span class="op">-</span>xmin)<span class="op">/</span>res_spatial_cell)
nrow &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">ceiling</a></span>((ymax<span class="op">-</span>ymin)<span class="op">/</span>res_spatial_cell)
Xmax &lt;-<span class="st"> </span>xmin<span class="op">+</span>ncol<span class="op">*</span>res_spatial_cell
Ymax &lt;-<span class="st"> </span>ymin<span class="op">+</span>nrow<span class="op">*</span>res_spatial_cell
ext &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/extent">extent</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(xmin, Xmax,
                ymin, Ymax))
landscape &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="dt">ncols=</span>ncol,<span class="dt">nrows=</span>nrow,ext)
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/getValues">values</a></span>(landscape) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/ncell">ncell</a></span>(landscape),<span class="dv">0</span>,<span class="dv">1</span>)
landscape.po &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(landscape)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(landscape.po)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(sites.sp, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">cex=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="st">"black"</span>)</code></pre>
<div class="figure" style="text-align: center">
<span id="fig:sites"></span>
<img src="hSDM_files/figure-html/sites-1.png" alt="Location of the 264 10 km\(^2\) quadrats of the Swiss national breeding bird survey. Points are located on a grid of 10 km\(^2\) cells. The grid is covering the geographical extent of the observation points." width="\textwidth"><p class="caption">
Figure 1.2: <strong>Location of the 264 10 km<span class="math inline">\(^2\)</span> quadrats of the Swiss national breeding bird survey.</strong> Points are located on a grid of 10 km<span class="math inline">\(^2\)</span> cells. The grid is covering the geographical extent of the observation points.
</p>
</div>
<p>One important step if we want to account for spatial dependence is to compute the neighborhood for each cell. In our case, the neighborhood is define by the “king move” in chess, in the height directions around the target cell. To compute the neighbordhood for each cell, we need the number of neighbors (which can vary) and the adjacent cell identifiers. We can use the function <code>adjacent</code> from the <code>raster</code> package to do this.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Neighborhood</span>
<span class="co"># Rasters must be projected to correctly compute the neighborhood</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/projection">crs</a></span>(landscape) &lt;-<span class="st"> '+proj=utm +zone=1'</span>
<span class="co"># Cell for each site</span>
cells &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/extract">extract</a></span>(landscape,sites.sp,<span class="dt">cell=</span><span class="ot">TRUE</span>)[,<span class="dv">1</span>]
<span class="co"># Neighborhood matrix</span>
ncells &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/ncell">ncell</a></span>(landscape)
neighbors.mat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/adjacent">adjacent</a></span>(landscape, <span class="dt">cells=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span>ncells), <span class="dt">directions=</span><span class="dv">8</span>,
                          <span class="dt">pairs=</span><span class="ot">TRUE</span>, <span class="dt">sorted=</span><span class="ot">TRUE</span>)
<span class="co"># Number of neighbors by cell</span>
n.neighbors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/as.data.frame">as.data.frame</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/factor">as.factor</a></span>(neighbors.mat[,<span class="dv">1</span>])))[,<span class="dv">2</span>]
<span class="co"># Adjacent cells</span>
adj &lt;-<span class="st"> </span>neighbors.mat[,<span class="dv">2</span>]</code></pre>
<p>We rearrange the data in two data-sets, one for the observation (or detection) process and one for the suitability (or ecological) process. The data for the observation process is in “long” format. Each row is an observation which is characterized by the site number and the julian date of the observation. The data for the suitability process (at the site level) includes information on sites (coordinates and elevation) by row.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Arranging data</span>
<span class="co"># data.obs</span>
nsite &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(data.Kery2010<span class="op">$</span>coordx)
count &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(data.Kery2010<span class="op">$</span>count1,data.Kery2010<span class="op">$</span>count2,data.Kery2010<span class="op">$</span>count3)
juldate &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(data.Kery2010<span class="op">$</span>juldate1,data.Kery2010<span class="op">$</span>juldate2,
             data.Kery2010<span class="op">$</span>juldate3)
site &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span><span class="op">:</span>nsite,<span class="dv">3</span>)
data.obs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(count,juldate,site)
data.obs &lt;-<span class="st"> </span>data.obs[<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(data.obs<span class="op">$</span>juldate),]
<span class="co"># data.suit</span>
data.suit &lt;-<span class="st"> </span>data.Kery2010[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"coordx"</span>,<span class="st">"coordy"</span>,<span class="st">"elevation"</span>)]
data.suit<span class="op">$</span>cells &lt;-<span class="st"> </span>cells
data.suit &lt;-<span class="st"> </span>data.suit[<span class="op">-</span><span class="dv">139</span>,] <span class="co"># Removing site 139 with no juldate</span></code></pre>
<p>We will compare three SDMs with increasing complexity: a first simple Poisson model, a second N-mixture model with imperfect detection, and a third N-mixture iCAR model with imperfect detection and spatial dependence.</p>
</div>
<div id="simple-poisson-model" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-poisson-model" class="anchor"></a><span class="header-section-number">2</span> Simple Poisson model</h1>
<p>To fit a simple Poisson model, we use the function <code>hSDM.poisson</code>. For this model, we slightly rearrange the observation data-set to associate the site altitude to each observation in a “long” format. The statistical model can be written as follow:</p>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># hSDM.poisson</span>
data.pois &lt;-<span class="st"> </span>data.obs
data.pois<span class="op">$</span>elevation &lt;-<span class="st"> </span>data.suit<span class="op">$</span>elevation[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/factor">as.factor</a></span>(data.obs<span class="op">$</span>site))]
mod.Kery2010.pois &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hSDM.poisson.html">hSDM.poisson</a></span>(<span class="dt">counts=</span>data.pois<span class="op">$</span>count,
                                  <span class="dt">suitability=</span><span class="op">~</span>elevation<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/AsIs">I</a></span>(elevation<span class="op">^</span><span class="dv">2</span>),
                                  <span class="dt">data=</span>data.pois, <span class="dt">beta.start=</span><span class="dv">0</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **********:10.0%, mean accept. rates= beta:0.473</span>
<span class="co">#&gt; **********:20.0%, mean accept. rates= beta:0.437</span>
<span class="co">#&gt; **********:30.0%, mean accept. rates= beta:0.460</span>
<span class="co">#&gt; **********:40.0%, mean accept. rates= beta:0.430</span>
<span class="co">#&gt; **********:50.0%, mean accept. rates= beta:0.430</span>
<span class="co">#&gt; **********:60.0%, mean accept. rates= beta:0.443</span>
<span class="co">#&gt; **********:70.0%, mean accept. rates= beta:0.470</span>
<span class="co">#&gt; **********:80.0%, mean accept. rates= beta:0.443</span>
<span class="co">#&gt; **********:90.0%, mean accept. rates= beta:0.413</span>
<span class="co">#&gt; **********:100.0%, mean accept. rates= beta:0.463</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Outputs</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(mod.Kery2010.pois<span class="op">$</span>mcmc)
<span class="co">#&gt; </span>
<span class="co">#&gt; Iterations = 5001:14991</span>
<span class="co">#&gt; Thinning interval = 10 </span>
<span class="co">#&gt; Number of chains = 1 </span>
<span class="co">#&gt; Sample size per chain = 1000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span>
<span class="co">#&gt;    plus standard error of the mean:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           Mean      SD Naive SE Time-series SE</span>
<span class="co">#&gt; beta.(Intercept)       0.02908 0.06369 0.002014       0.003676</span>
<span class="co">#&gt; beta.elevation         3.07617 0.16616 0.005254       0.018741</span>
<span class="co">#&gt; beta.I(elevation^2)   -1.79461 0.11144 0.003524       0.011860</span>
<span class="co">#&gt; Deviance            2157.97699 2.35949 0.074614       0.137429</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 2. Quantiles for each variable:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           2.5%        25%        50%       75%     97.5%</span>
<span class="co">#&gt; beta.(Intercept)      -0.09654   -0.01742    0.02864    0.0744    0.1528</span>
<span class="co">#&gt; beta.elevation         2.76477    2.95534    3.07390    3.1958    3.3890</span>
<span class="co">#&gt; beta.I(elevation^2)   -2.02038   -1.87021   -1.79278   -1.7178   -1.5802</span>
<span class="co">#&gt; Deviance            2155.19872 2156.26439 2157.38672 2159.0371 2164.2946</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predictions</span>
npred &lt;-<span class="st"> </span><span class="dv">100</span>
nsamp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/dimensions">dim</a></span>(mod.Kery2010.pois<span class="op">$</span>mcmc)[<span class="dv">1</span>]
<span class="co"># Abundance-elevation</span>
elev.seq &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">500</span>,<span class="dv">3000</span>,<span class="dt">length.out=</span>npred)
elev.seq.n &lt;-<span class="st"> </span>(elev.seq<span class="op">-</span>elev.mean)<span class="op">/</span>elev.sd
beta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/as.matrix">as.matrix</a></span>(mod.Kery2010.pois<span class="op">$</span>mcmc[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])
tbeta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/transpose">t</a></span>(beta)
X &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,npred),elev.seq.n,elev.seq.n<span class="op">^</span><span class="dv">2</span>),<span class="dt">ncol=</span><span class="dv">3</span>)
N &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>nsamp,<span class="dt">ncol=</span>npred)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>npred) {
    N[,i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(X[i,] <span class="op">%*%</span><span class="st"> </span>tbeta)
}
N.est.pois &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,mean)
N.q1.pois &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,quantile,<span class="fl">0.025</span>)
N.q2.pois &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,quantile,<span class="fl">0.975</span>)</code></pre>
</div>
<div id="n-mixture-model-for-imperfect-detection" class="section level1">
<h1 class="hasAnchor">
<a href="#n-mixture-model-for-imperfect-detection" class="anchor"></a><span class="header-section-number">3</span> N-mixture model for imperfect detection</h1>
<p>The model integrates two processes, an <em>ecological</em> process associated to the abundance of the
species due to habitat suitability and an <em>observation</em> process that takes into account the fact that the probability of detection of the species is inferior to one.</p>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># hSDM.Nmixture</span>
mod.Kery2010.Nmix &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hSDM.Nmixture.html">hSDM.Nmixture</a></span>(<span class="co"># Observations</span>
                     <span class="dt">counts=</span>data.obs<span class="op">$</span>count,
                     <span class="dt">observability=</span><span class="op">~</span>juldate<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/AsIs">I</a></span>(juldate<span class="op">^</span><span class="dv">2</span>),
                     <span class="dt">site=</span>data.obs<span class="op">$</span>site,
                     <span class="dt">data.observability=</span>data.obs,
                     <span class="co"># Habitat</span>
                     <span class="dt">suitability=</span><span class="op">~</span>elevation<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/AsIs">I</a></span>(elevation<span class="op">^</span><span class="dv">2</span>),
                     <span class="dt">data.suitability=</span>data.suit,
                     <span class="co"># Predictions</span>
                     <span class="dt">suitability.pred=</span><span class="ot">NULL</span>,
                     <span class="co"># Chains</span>
                     <span class="dt">burnin=</span><span class="dv">10000</span>, <span class="dt">mcmc=</span><span class="dv">5000</span>, <span class="dt">thin=</span><span class="dv">5</span>,
                     <span class="co"># Starting values</span>
                     <span class="dt">beta.start=</span><span class="dv">0</span>,
                     <span class="dt">gamma.start=</span><span class="dv">0</span>,
                     <span class="co"># Priors</span>
                     <span class="dt">mubeta=</span><span class="dv">0</span>, <span class="dt">Vbeta=</span><span class="fl">1.0E6</span>,
                     <span class="dt">mugamma=</span><span class="dv">0</span>, <span class="dt">Vgamma=</span><span class="fl">1.0E6</span>,
                     <span class="co"># Various</span>
                     <span class="dt">seed=</span><span class="dv">1234</span>, <span class="dt">verbose=</span><span class="dv">1</span>,
                     <span class="dt">save.p=</span><span class="dv">0</span>, <span class="dt">save.N=</span><span class="dv">0</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **********:10.0%, mean accept. rates= beta:0.213, gamma:0.253, N:0.172</span>
<span class="co">#&gt; **********:20.0%, mean accept. rates= beta:0.240, gamma:0.230, N:0.205</span>
<span class="co">#&gt; **********:30.0%, mean accept. rates= beta:0.240, gamma:0.247, N:0.183</span>
<span class="co">#&gt; **********:40.0%, mean accept. rates= beta:0.270, gamma:0.250, N:0.193</span>
<span class="co">#&gt; **********:50.0%, mean accept. rates= beta:0.327, gamma:0.233, N:0.189</span>
<span class="co">#&gt; **********:60.0%, mean accept. rates= beta:0.313, gamma:0.263, N:0.197</span>
<span class="co">#&gt; **********:70.0%, mean accept. rates= beta:0.273, gamma:0.223, N:0.211</span>
<span class="co">#&gt; **********:80.0%, mean accept. rates= beta:0.257, gamma:0.240, N:0.218</span>
<span class="co">#&gt; **********:90.0%, mean accept. rates= beta:0.310, gamma:0.300, N:0.168</span>
<span class="co">#&gt; **********:100.0%, mean accept. rates= beta:0.257, gamma:0.230, N:0.206</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Outputs</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(mod.Kery2010.Nmix<span class="op">$</span>mcmc)
<span class="co">#&gt; </span>
<span class="co">#&gt; Iterations = 10001:14996</span>
<span class="co">#&gt; Thinning interval = 5 </span>
<span class="co">#&gt; Number of chains = 1 </span>
<span class="co">#&gt; Sample size per chain = 1000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span>
<span class="co">#&gt;    plus standard error of the mean:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                          Mean       SD Naive SE Time-series SE</span>
<span class="co">#&gt; beta.(Intercept)       0.6484  0.08698 0.002750       0.007622</span>
<span class="co">#&gt; beta.elevation         2.9294  0.20188 0.006384       0.031113</span>
<span class="co">#&gt; beta.I(elevation^2)   -1.8782  0.13632 0.004311       0.019594</span>
<span class="co">#&gt; gamma.(Intercept)      0.2419  0.10853 0.003432       0.009402</span>
<span class="co">#&gt; gamma.juldate         -0.2356  0.08556 0.002706       0.004650</span>
<span class="co">#&gt; gamma.I(juldate^2)     0.2705  0.08694 0.002749       0.006721</span>
<span class="co">#&gt; Deviance            1889.7198 29.49971 0.932863       2.417696</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 2. Quantiles for each variable:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           2.5%       25%       50%       75%      97.5%</span>
<span class="co">#&gt; beta.(Intercept)       0.47179    0.5895    0.6484    0.7112    0.80779</span>
<span class="co">#&gt; beta.elevation         2.52078    2.7878    2.9250    3.0673    3.30330</span>
<span class="co">#&gt; beta.I(elevation^2)   -2.14580   -1.9673   -1.8808   -1.7859   -1.59867</span>
<span class="co">#&gt; gamma.(Intercept)      0.02988    0.1652    0.2435    0.3228    0.45101</span>
<span class="co">#&gt; gamma.juldate         -0.41117   -0.2907   -0.2347   -0.1766   -0.07425</span>
<span class="co">#&gt; gamma.I(juldate^2)     0.10274    0.2137    0.2704    0.3317    0.43780</span>
<span class="co">#&gt; Deviance            1837.06422 1868.9839 1887.4536 1907.9318 1954.82932</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predictions</span>
nsamp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/dimensions">dim</a></span>(mod.Kery2010.Nmix<span class="op">$</span>mcmc)[<span class="dv">1</span>]
<span class="co"># Abundance-elevation</span>
beta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/as.matrix">as.matrix</a></span>(mod.Kery2010.Nmix<span class="op">$</span>mcmc[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])
tbeta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/transpose">t</a></span>(beta)
N &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>nsamp,<span class="dt">ncol=</span>npred)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>npred) {
    N[,i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(X[i,] <span class="op">%*%</span><span class="st"> </span>tbeta)
}
N.est.Nmix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,mean)
N.q1.Nmix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,quantile,<span class="fl">0.025</span>)
N.q2.Nmix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,quantile,<span class="fl">0.975</span>)
<span class="co"># Detection-Julian date</span>
juldate.seq &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">100</span>,<span class="dv">200</span>,<span class="dt">length.out=</span>npred)
juldate.seq.n &lt;-<span class="st"> </span>(juldate.seq<span class="op">-</span>juldate.mean)<span class="op">/</span>juldate.sd
gamma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/as.matrix">as.matrix</a></span>(mod.Kery2010.Nmix<span class="op">$</span>mcmc[,<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>])
tgamma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/transpose">t</a></span>(gamma)
W &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,npred),juldate.seq.n,juldate.seq.n<span class="op">^</span><span class="dv">2</span>),<span class="dt">ncol=</span><span class="dv">3</span>)
delta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>nsamp,<span class="dt">ncol=</span>npred)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>npred) {
    delta[,i] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/logit.html">inv.logit</a></span>(X[i,] <span class="op">%*%</span><span class="st"> </span>tgamma)
}
delta.est.Nmix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(delta,<span class="dv">2</span>,mean)
delta.q1.Nmix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(delta,<span class="dv">2</span>,quantile,<span class="fl">0.025</span>)
delta.q2.Nmix &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(delta,<span class="dv">2</span>,quantile,<span class="fl">0.975</span>)</code></pre>
</div>
<div id="n-mixture-model-with-icar-process" class="section level1">
<h1 class="hasAnchor">
<a href="#n-mixture-model-with-icar-process" class="anchor"></a><span class="header-section-number">4</span> N-mixture model with iCAR process</h1>
<p>For this model, we assume that the abundance of the species at one site depends on the abundance of the species on neighboring sites. In this model, the <em>ecological</em> process includes an intrinsic conditional autoregressive (iCAR) subprocess to model the spatial dependence between observations.</p>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># hSDM.Nmixture.iCAR</span>
mod.Kery2010.Nmix.iCAR &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hSDM.Nmixture.iCAR.html">hSDM.Nmixture.iCAR</a></span>(<span class="co"># Observations</span>
                            <span class="dt">counts=</span>data.obs<span class="op">$</span>count,
                            <span class="dt">observability=</span><span class="op">~</span>juldate<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/AsIs">I</a></span>(juldate<span class="op">^</span><span class="dv">2</span>),
                            <span class="dt">site=</span>data.obs<span class="op">$</span>site,
                            <span class="dt">data.observability=</span>data.obs,
                            <span class="co"># Habitat</span>
                            <span class="dt">suitability=</span><span class="op">~</span>elevation<span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/AsIs">I</a></span>(elevation<span class="op">^</span><span class="dv">2</span>),
                            <span class="dt">data.suitability=</span>data.suit,
                            <span class="co"># Spatial structure</span>
                            <span class="dt">spatial.entity=</span>data.suit<span class="op">$</span>cells,
                            <span class="dt">n.neighbors=</span>n.neighbors, <span class="dt">neighbors=</span>adj,
                            <span class="co"># Chains</span>
                            <span class="dt">burnin=</span><span class="dv">20000</span>, <span class="dt">mcmc=</span><span class="dv">10000</span>, <span class="dt">thin=</span><span class="dv">10</span>,
                            <span class="co"># Starting values</span>
                            <span class="dt">beta.start=</span><span class="dv">0</span>,
                            <span class="dt">gamma.start=</span><span class="dv">0</span>,
                            <span class="dt">Vrho.start=</span><span class="dv">1</span>,
                            <span class="co"># Priors</span>
                            <span class="dt">mubeta=</span><span class="dv">0</span>, <span class="dt">Vbeta=</span><span class="fl">1.0E6</span>,
                            <span class="dt">mugamma=</span><span class="dv">0</span>, <span class="dt">Vgamma=</span><span class="fl">1.0E6</span>,
                            <span class="dt">priorVrho=</span><span class="st">"1/Gamma"</span>,
                            <span class="dt">shape=</span><span class="dv">1</span>, <span class="dt">rate=</span><span class="dv">1</span>,
                            <span class="co"># Various</span>
                            <span class="dt">seed=</span><span class="dv">1234</span>, <span class="dt">verbose=</span><span class="dv">1</span>,
                            <span class="dt">save.rho=</span><span class="dv">0</span>, <span class="dt">save.p=</span><span class="dv">0</span>, <span class="dt">save.N=</span><span class="dv">0</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; **********:10.0%, mean accept. rates= beta:0.263, gamma:0.257, rho:0.257, N:0.279</span>
<span class="co">#&gt; **********:20.0%, mean accept. rates= beta:0.270, gamma:0.253, rho:0.250, N:0.232</span>
<span class="co">#&gt; **********:30.0%, mean accept. rates= beta:0.260, gamma:0.263, rho:0.283, N:0.251</span>
<span class="co">#&gt; **********:40.0%, mean accept. rates= beta:0.237, gamma:0.277, rho:0.253, N:0.249</span>
<span class="co">#&gt; **********:50.0%, mean accept. rates= beta:0.270, gamma:0.290, rho:0.252, N:0.232</span>
<span class="co">#&gt; **********:60.0%, mean accept. rates= beta:0.253, gamma:0.297, rho:0.280, N:0.234</span>
<span class="co">#&gt; **********:70.0%, mean accept. rates= beta:0.313, gamma:0.297, rho:0.254, N:0.285</span>
<span class="co">#&gt; **********:80.0%, mean accept. rates= beta:0.283, gamma:0.250, rho:0.281, N:0.279</span>
<span class="co">#&gt; **********:90.0%, mean accept. rates= beta:0.323, gamma:0.250, rho:0.289, N:0.236</span>
<span class="co">#&gt; **********:100.0%, mean accept. rates= beta:0.287, gamma:0.273, rho:0.275, N:0.248</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(mod.Kery2010.Nmix.iCAR<span class="op">$</span>mcmc)
<span class="co">#&gt; </span>
<span class="co">#&gt; Iterations = 20001:29991</span>
<span class="co">#&gt; Thinning interval = 10 </span>
<span class="co">#&gt; Number of chains = 1 </span>
<span class="co">#&gt; Sample size per chain = 1000 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span>
<span class="co">#&gt;    plus standard error of the mean:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                          Mean       SD Naive SE Time-series SE</span>
<span class="co">#&gt; beta.(Intercept)       0.3749  0.32613 0.010313       0.040265</span>
<span class="co">#&gt; beta.elevation         1.9973  0.84697 0.026784       0.279847</span>
<span class="co">#&gt; beta.I(elevation^2)   -2.1986  0.48710 0.015403       0.142238</span>
<span class="co">#&gt; gamma.(Intercept)     -0.8790  0.20105 0.006358       0.062329</span>
<span class="co">#&gt; gamma.juldate         -0.1735  0.06543 0.002069       0.003898</span>
<span class="co">#&gt; gamma.I(juldate^2)     0.1589  0.05885 0.001861       0.004153</span>
<span class="co">#&gt; Vrho                  18.1555  4.97802 0.157419       0.547617</span>
<span class="co">#&gt; Deviance            1336.0869 48.14174 1.522376       9.021355</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 2. Quantiles for each variable:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                           2.5%       25%       50%       75%      97.5%</span>
<span class="co">#&gt; beta.(Intercept)      -0.20728    0.1364    0.3661    0.6001    1.02133</span>
<span class="co">#&gt; beta.elevation         0.62581    1.2987    1.8709    2.6526    3.65104</span>
<span class="co">#&gt; beta.I(elevation^2)   -3.32975   -2.5131   -2.1079   -1.8235   -1.45366</span>
<span class="co">#&gt; gamma.(Intercept)     -1.29729   -1.0030   -0.8879   -0.7457   -0.48283</span>
<span class="co">#&gt; gamma.juldate         -0.29657   -0.2167   -0.1739   -0.1309   -0.04227</span>
<span class="co">#&gt; gamma.I(juldate^2)     0.04234    0.1187    0.1607    0.1958    0.27203</span>
<span class="co">#&gt; Vrho                  10.78215   14.6705   17.4504   20.7555   30.86624</span>
<span class="co">#&gt; Deviance            1248.61524 1302.4338 1334.8412 1368.8538 1430.86366</span></code></pre>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Spatial random effects</span>
rho.pred &lt;-<span class="st"> </span>mod.Kery2010.Nmix.iCAR<span class="op">$</span>rho.pred
r.rho.pred &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterFromXYZ">rasterFromXYZ</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(landscape),rho.pred))
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(r.rho.pred)
<span class="co"># Mean abundance by site</span>
ma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(sites.sp<span class="op">@</span>data[,<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>],<span class="dv">1</span>,mean,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(sites.sp,<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">cex=</span><span class="fl">0.5</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/points">points</a></span>(sites.sp,<span class="dt">pch=</span><span class="dv">1</span>,<span class="dt">cex=</span>ma<span class="op">/</span><span class="dv">2</span>)</code></pre>
<div class="figure" style="text-align: center">
<span id="fig:Kery2010-Nmix-iCAR-spatial-effects"></span>
<img src="hSDM_files/figure-html/Kery2010-Nmix-iCAR-spatial-effects-1.png" alt="Estimated spatial random effects. Locations of observation quadrats are represented by dots. The mean abundance on each quadrat is represented by a circle of size proportional to abundance." width="\textwidth"><p class="caption">
Figure 4.1: <strong>Estimated spatial random effects.</strong> Locations of observation quadrats are represented by dots. The mean abundance on each quadrat is represented by a circle of size proportional to abundance.
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predictions</span>
nsamp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/dimensions">dim</a></span>(mod.Kery2010.Nmix.iCAR<span class="op">$</span>mcmc)[<span class="dv">1</span>]
<span class="co"># Abundance-elevation</span>
beta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/as.matrix">as.matrix</a></span>(mod.Kery2010.Nmix.iCAR<span class="op">$</span>mcmc[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])
tbeta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/transpose">t</a></span>(beta)
N &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>nsamp,<span class="dt">ncol=</span>npred)
<span class="co"># Simplified way of obtaining samples for rho</span>
rho.samp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(rho.pred,nsamp,<span class="dt">replace=</span><span class="ot">TRUE</span>)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>npred) {
    N[,i] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(X[i,] <span class="op">%*%</span><span class="st"> </span>tbeta <span class="op">+</span><span class="st"> </span>rho.samp)
}
N.est.Nmix.iCAR &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,mean)
N.q1.Nmix.iCAR &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,quantile,<span class="fl">0.025</span>)
N.q2.Nmix.iCAR &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(N,<span class="dv">2</span>,quantile,<span class="fl">0.975</span>)

<span class="co"># Detection-Julian date</span>
gamma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/as.matrix">as.matrix</a></span>(mod.Kery2010.Nmix.iCAR<span class="op">$</span>mcmc[,<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>])
tgamma &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/transpose">t</a></span>(gamma)
delta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="ot">NA</span>,<span class="dt">nrow=</span>nsamp,<span class="dt">ncol=</span>npred)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>npred) {
    delta[,i] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/logit.html">inv.logit</a></span>(X[i,] <span class="op">%*%</span><span class="st"> </span>tgamma)
}
delta.est.Nmix.iCAR &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(delta,<span class="dv">2</span>,mean)
delta.q1.Nmix.iCAR &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(delta,<span class="dv">2</span>,quantile,<span class="fl">0.025</span>)
delta.q2.Nmix.iCAR &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(delta,<span class="dv">2</span>,quantile,<span class="fl">0.975</span>)</code></pre>
</div>
<div id="comparing-predictions-from-the-three-different-models" class="section level1">
<h1 class="hasAnchor">
<a href="#comparing-predictions-from-the-three-different-models" class="anchor"></a><span class="header-section-number">5</span> Comparing predictions from the three different models</h1>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Expected abundance - Elevation</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">cex=</span><span class="fl">1.4</span>,<span class="dt">tcl=</span><span class="op">+</span><span class="fl">0.5</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(elev.seq,N.est.pois,<span class="dt">type=</span><span class="st">"l"</span>,
     <span class="dt">xlim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">500</span>,<span class="dv">3000</span>),
     <span class="dt">ylim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">10</span>),
     <span class="dt">lwd=</span><span class="dv">2</span>,
     <span class="dt">xlab=</span><span class="st">"Elevation (m a.s.l.)"</span>,
     <span class="dt">ylab=</span><span class="st">"Expected abundance"</span>,
     <span class="dt">axes=</span><span class="ot">FALSE</span>)
<span class="co">#lines(elev.seq,N.q1.pois,lty=3,lwd=1)</span>
<span class="co">#lines(elev.seq,N.q2.pois,lty=3,lwd=1)</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/axis">axis</a></span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">500</span>,<span class="dv">3000</span>,<span class="dt">by=</span><span class="dv">500</span>),<span class="dt">labels=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">500</span>,<span class="dv">3000</span>,<span class="dt">by=</span><span class="dv">500</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/axis">axis</a></span>(<span class="dv">2</span>,<span class="dt">at=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dt">by=</span><span class="dv">2</span>),<span class="dt">labels=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dt">by=</span><span class="dv">2</span>))
<span class="co"># Nmix</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(elev.seq,N.est.Nmix,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">"red"</span>)
<span class="co">#lines(elev.seq,N.q1.Nmix,lty=3,lwd=1,col="red")</span>
<span class="co">#lines(elev.seq,N.q2.Nmix,lty=3,lwd=1,col="red")</span>
<span class="co"># Nmix.iCAR</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(elev.seq,N.est.Nmix.iCAR,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">"dark green"</span>)</code></pre>
<div class="figure" style="text-align: center">
<span id="fig:Kery2010-comp-abundance"></span>
<img src="hSDM_files/figure-html/Kery2010-comp-abundance-1.png" alt="Relationship between abundance and altitude. Black: Poisson model, Red: N-mixture model, Green: N-mixture model with iCAR." width="576"><p class="caption">
Figure 5.1: <strong>Relationship between abundance and altitude.</strong> Black: Poisson model, Red: N-mixture model, Green: N-mixture model with iCAR.
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#lines(elev.seq,N.q1.Nmix.iCAR,lty=3,lwd=1,col="dark green")</span>
<span class="co">#lines(elev.seq,N.q2.Nmix.iCAR,lty=3,lwd=1,col="dark green")</span></code></pre>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Detection probability - Julian date</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">cex=</span><span class="fl">1.4</span>,<span class="dt">tcl=</span><span class="op">+</span><span class="fl">0.5</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(juldate.seq,delta.est.Nmix,<span class="dt">type=</span><span class="st">"l"</span>,
     <span class="dt">xlim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">100</span>,<span class="dv">200</span>),
     <span class="dt">ylim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>),
     <span class="dt">lwd=</span><span class="dv">2</span>,
     <span class="dt">col=</span><span class="st">"red"</span>,
     <span class="dt">xlab=</span><span class="st">"Julian date"</span>,
     <span class="dt">ylab=</span><span class="st">"Detection probability"</span>,
     <span class="dt">axes=</span><span class="ot">FALSE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(juldate.seq,delta.q1.Nmix,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="st">"red"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(juldate.seq,delta.q2.Nmix,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="st">"red"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/axis">axis</a></span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">100</span>,<span class="dv">200</span>,<span class="dt">by=</span><span class="dv">20</span>),<span class="dt">labels=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">100</span>,<span class="dv">200</span>,<span class="dt">by=</span><span class="dv">20</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/axis">axis</a></span>(<span class="dv">2</span>,<span class="dt">at=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.2</span>),<span class="dt">labels=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.2</span>))
<span class="co"># Nmix.iCAR</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(juldate.seq,delta.est.Nmix.iCAR,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">"dark green"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(juldate.seq,delta.q1.Nmix.iCAR,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="st">"dark green"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(juldate.seq,delta.q2.Nmix.iCAR,<span class="dt">lty=</span><span class="dv">3</span>,<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="st">"dark green"</span>)</code></pre>
<div class="figure" style="text-align: center">
<span id="fig:Kery2010-comp-detection"></span>
<img src="hSDM_files/figure-html/Kery2010-comp-detection-1.png" alt="Relationship between detection probability and observation date. Red: N-mixture model, Green: N-mixture model with iCAR." width="576"><p class="caption">
Figure 5.2: <strong>Relationship between detection probability and observation date.</strong> Red: N-mixture model, Green: N-mixture model with iCAR.
</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Clark2007">
<p>Clark, J.S. (2007) <em>Models for Ecological Data : An Introduction</em>. Princeton University Press.</p>
</div>
<div id="ref-Flores2009">
<p>Flores, O., Rossi, V. &amp; Mortier, F. (2009) Autocorrelation offsets zero-inflation in models of tropical saplings density. <em>Ecological Modelling</em>, <strong>220</strong>, 1797–1809.</p>
</div>
<div id="ref-Kery2010b">
<p>Kéry, M. &amp; Andrew Royle, J. (2010) Hierarchical modelling and estimation of abundance and population trends in metapopulation designs. <em>Journal of Animal Ecology</em>, <strong>79</strong>, 453–461.</p>
</div>
<div id="ref-Lahoz-Monfort2014">
<p>Lahoz-Monfort, J.J., Guillera-Arroita, G. &amp; Wintle, B.A. (2014) Imperfect detection impacts the performance of species distribution models. <em>Global Ecology and Biogeography</em>, <strong>23</strong>, 504–515.</p>
</div>
<div id="ref-Latimer2006">
<p>Latimer, A.M., Wu, S.S., Gelfand, A.E. &amp; Silander, J.A. (2006) Building statistical models to analyze species distributions. <em>Ecological Applications</em>, <strong>16</strong>, 33–50.</p>
</div>
<div id="ref-Lichstein2002">
<p>Lichstein, J.W., Simons, T.R., Shriner, S.A. &amp; Franzreb, K.E. (2002) Spatial autocorrelation and autoregressive models in ecology. <em>Ecological Monographs</em>, <strong>72</strong>, 445–463.</p>
</div>
<div id="ref-MacKenzie2002">
<p>MacKenzie, D.I., Nichols, J.D., Lachman, G.B., Droege, S., Andrew Royle, J. &amp; Langtimm, C.A. (2002) Estimating site occupancy rates when detection probabilities are less than one. <em>Ecology</em>, <strong>83</strong>, 2248–2255.</p>
</div>
<div id="ref-Royle2004">
<p>Royle, J.A. (2004) N-mixture models for estimating population size from spatially replicated counts. <em>Biometrics</em>, <strong>60</strong>, 108–115.</p>
</div>
<div id="ref-Wilson2016">
<p>Wilson, A.M. &amp; Jetz, W. (2016) Remotely sensed high-resolution global cloud dynamics for predicting ecosystem and biodiversity distributions ed M. Loreau. <em>PLOS Biology</em>, <strong>14</strong>, e1002415.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-set"><span class="toc-section-number">1</span> Data-set</a></li>
      <li><a href="#simple-poisson-model"><span class="toc-section-number">2</span> Simple Poisson model</a></li>
      <li><a href="#n-mixture-model-for-imperfect-detection"><span class="toc-section-number">3</span> N-mixture model for imperfect detection</a></li>
      <li><a href="#n-mixture-model-with-icar-process"><span class="toc-section-number">4</span> N-mixture model with iCAR process</a></li>
      <li><a href="#comparing-predictions-from-the-three-different-models"><span class="toc-section-number">5</span> Comparing predictions from the three different models</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://ecology.ghislainv.fr">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr"><img src="https://ecology.ghislainv.fr/images/logos/logo-cirad.svg" height="24"></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
