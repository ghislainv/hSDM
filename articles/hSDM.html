<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to hSDM • hSDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to hSDM">
<meta property="og:description" content="hSDM">
<meta property="og:image" content="https://ecology.ghislainv.fr/hSDM/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hSDM.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/publications.html">Publications</a>
</li>
<li>
  <a href="../news/index.html">Change log</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ghislainv/hSDM" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to hSDM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ghislainv/hSDM/blob/HEAD/vignettes/hSDM.Rmd" class="external-link"><code>vignettes/hSDM.Rmd</code></a></small>
      <div class="hidden name"><code>hSDM.Rmd</code></div>

    </div>

    
    
<p>Species distribution models (SDM) are useful tools to explain or predict species range and abundance from various environmental factors. SDM are thus widely used in conservation biology. When using field observations (occurence or abundance data) to fit SDMs, two major problems can arise leading to potential bias in models’ results: imperfect detection <span class="citation">(<a href="#ref-Lahoz-Monfort2014" role="doc-biblioref">Lahoz-Monfort, Guillera-Arroita &amp; Wintle 2014</a>)</span> and spatial dependence of the observations <span class="citation">(<a href="#ref-Lichstein2002" role="doc-biblioref">Lichstein <em>et al.</em> 2002</a>)</span>. In this vignette, we illustrate the use of the <code>hSDM</code> R package wich aims at providing user-friendly statistical functions to account for both imperfect detection and spatial dependence. Package’s functions are developped in a hierarchical Bayesian framework. Functions call a Metropolis-within-Gibbs algorithm coded in C to estimate model’s parameters. Using compiled C code for the Gibbs sampler reduce drastically the computation time. By making these new statistical tools available to the scientific community, we hope to democratize the use of more complex, but more realistic, statistical models for increasing knowledge in ecology and conserving biodiversity.</p>
<p>Below, we show an example of the use of <code>hSDM</code> for fitting a species distribution model to abundance data for a bird species. Model types available in <code>hSDM</code> are not limited to those described in this example. <code>hSDM</code> includes various model types (for various contexts: imperfect detection, spatial dependence, zero-inflation, land transformation) for both occurrence and abundance data:</p>
<ul>
<li>simple Binomial and Poisson models <span class="citation">(<a href="#ref-Clark2007" role="doc-biblioref">Clark 2007</a>)</span>
</li>
<li>site-occupancy models <span class="citation">(<a href="#ref-MacKenzie2002" role="doc-biblioref">MacKenzie <em>et al.</em> 2002</a>)</span>
</li>
<li>N-mixture models <span class="citation">(<a href="#ref-Royle2004" role="doc-biblioref">Royle 2004</a>)</span>
</li>
<li>Zero-Inflated Binomial (ZIB) models <span class="citation">(<a href="#ref-Wilson2016" role="doc-biblioref">Wilson &amp; Jetz 2016</a>)</span>
</li>
<li>Zero-Inflated Poisson (ZIP) models <span class="citation">(<a href="#ref-Flores2009" role="doc-biblioref">Flores, Rossi &amp; Mortier 2009</a>)</span>
</li>
<li>less common mixture models to account for land degradation <span class="citation">(<a href="#ref-Latimer2006" role="doc-biblioref">Latimer <em>et al.</em> 2006</a>)</span>
</li>
</ul>
<p>All the above models can include an additional intrinsic conditional autoregressive (iCAR) process to account for the spatial dependence of the observations. It should be easy for the user to fit other model types from the example below as function arguments are rather similar from one model to the other.</p>
<div class="section level2" number="1">
<h2 id="data-set">
<span class="header-section-number">1</span> Data-set<a class="anchor" aria-label="anchor" href="#data-set"></a>
</h2>
<p>The data-set from <span class="citation">Kéry &amp; Andrew Royle (<a href="#ref-Kery2010b" role="doc-biblioref">2010</a>)</span> includes repeated count data for the Willow tit (<em>Poecile montanus</em>, a pesserine bird, Fig. <a href="#fig:Willow-tit">1.1</a>) in Switzerland on the period 1999-2003. Data come from the Swiss national breeding bird survey MHB (Monitoring Haüfige Brutvögel). MHB is based on 264 1-km<span class="math inline">\(^2\)</span> sampling units (quadrats) laid out as a grid (Fig. <a href="#fig:sites">1.2</a>). Since 1999, every quadrat has been surveyed two to three times during most breeding seasons (15 April to 15 July). The Willow tit is a widespread but moderately rare bird species. It has a weak song and elusive behaviour and can be rather difficult to detect.</p>

<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:Willow-tit"></span>
<img src="figures/Poecile_montanus.jpg" alt="Willow tit (Poecile montanus)." width="\textwidth"><p class="caption">
Figure 1.1: <strong>Willow tit (<em>Poecile montanus</em>).</strong>
</p>
</div>
<p>We first load some necessary packages. The <code>sp</code> and <code>raster</code> packages will be used for manipulating spatial data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ecology.ghislainv.fr/hSDM/">hSDM</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ##</span></span>
<span><span class="co">#&gt; ## hSDM R package </span></span>
<span><span class="co">#&gt; ## For hierarchical Bayesian species distribution models </span></span>
<span><span class="co">#&gt; ##</span></span></code></pre></div>
<p>This data-set from <span class="citation">Kéry &amp; Andrew Royle (<a href="#ref-Kery2010b" role="doc-biblioref">2010</a>)</span> is available in the <code>hSDM</code> R package. It can be loaded with the <code>data</code> command and formated to be used with <code>hSDM</code> functions. The data is in “wide” format: each line is a site and the repeated count data (from count1 to count3) are in columns. A site is characterized by its x-y geographical coordinates, elevation (in m) and forest cover (in %). The date of each observation (julian date) has been recorded.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Kéry et al. 2010 data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">data.Kery2010</span>, package<span class="op">=</span><span class="st">"hSDM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">)</span></span>
<span><span class="co">#&gt;   coordx coordy elevation forest count1 count2 count3 juldate1 juldate2</span></span>
<span><span class="co">#&gt; 1    497    118       450      3      0      0      0      114      139</span></span>
<span><span class="co">#&gt; 2    503    134       450     21      0      0      0      108      130</span></span>
<span><span class="co">#&gt; 3    503    158      1050     32      1      1      0      116      145</span></span>
<span><span class="co">#&gt; 4    509    166      1150     35      0      0      0      106      134</span></span>
<span><span class="co">#&gt; 5    509    150       950     NA      0      0      0      121      152</span></span>
<span><span class="co">#&gt; 6    521    150       550      2      0      0      0      114      141</span></span>
<span><span class="co">#&gt;   juldate3</span></span>
<span><span class="co">#&gt; 1      166</span></span>
<span><span class="co">#&gt; 2      158</span></span>
<span><span class="co">#&gt; 3      177</span></span>
<span><span class="co">#&gt; 4      160</span></span>
<span><span class="co">#&gt; 5      166</span></span>
<span><span class="co">#&gt; 6      150</span></span></code></pre></div>
<p>We first normalize the data to facilitate MCMC convergence. We discard the forest cover in our example.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Normalized variables</span></span>
<span><span class="va">elev.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">elevation</span><span class="op">)</span></span>
<span><span class="va">elev.sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">elevation</span><span class="op">)</span></span>
<span><span class="va">juldate.mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate1</span>,</span>
<span>                     <span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate2</span>,</span>
<span>                     <span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate3</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">juldate.sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate1</span>,</span>
<span>                 <span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate2</span>,</span>
<span>                 <span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate3</span><span class="op">)</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">elevation</span><span class="op">-</span><span class="va">elev.mean</span><span class="op">)</span><span class="op">/</span><span class="va">elev.sd</span></span>
<span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate1</span><span class="op">-</span><span class="va">juldate.mean</span><span class="op">)</span><span class="op">/</span><span class="va">juldate.sd</span></span>
<span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate2</span><span class="op">-</span><span class="va">juldate.mean</span><span class="op">)</span><span class="op">/</span><span class="va">juldate.sd</span></span>
<span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate3</span><span class="op">-</span><span class="va">juldate.mean</span><span class="op">)</span><span class="op">/</span><span class="va">juldate.sd</span></span></code></pre></div>
<p>We plot the observation sites over a grid of 10 <span class="math inline">\(\times\)</span> 10 km<span class="math inline">\(^2\)</span> cells.</p>

<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Landscape and observation sites</span></span>
<span><span class="va">sites.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html" class="external-link">SpatialPointsDataFrame</a></span><span class="op">(</span>coords<span class="op">=</span><span class="va">data.Kery2010</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coordx"</span>,<span class="st">"coordy"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                   data<span class="op">=</span><span class="va">data.Kery2010</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">xmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">coordx</span><span class="op">)</span></span>
<span><span class="va">xmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">coordx</span><span class="op">)</span></span>
<span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">coordy</span><span class="op">)</span></span>
<span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">coordy</span><span class="op">)</span></span>
<span><span class="va">res_spatial_cell</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">ncol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="op">(</span><span class="va">xmax</span><span class="op">-</span><span class="va">xmin</span><span class="op">)</span><span class="op">/</span><span class="va">res_spatial_cell</span><span class="op">)</span></span>
<span><span class="va">nrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="op">(</span><span class="va">ymax</span><span class="op">-</span><span class="va">ymin</span><span class="op">)</span><span class="op">/</span><span class="va">res_spatial_cell</span><span class="op">)</span></span>
<span><span class="va">Xmax</span> <span class="op">&lt;-</span> <span class="va">xmin</span><span class="op">+</span><span class="va">ncol</span><span class="op">*</span><span class="va">res_spatial_cell</span></span>
<span><span class="va">Ymax</span> <span class="op">&lt;-</span> <span class="va">ymin</span><span class="op">+</span><span class="va">nrow</span><span class="op">*</span><span class="va">res_spatial_cell</span></span>
<span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">Xmax</span>,</span>
<span>                <span class="va">ymin</span>, <span class="va">Ymax</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">landscape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span>ncols<span class="op">=</span><span class="va">ncol</span>,nrows<span class="op">=</span><span class="va">nrow</span>,<span class="va">ext</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">landscape.po</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPolygons.html" class="external-link">rasterToPolygons</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">landscape.po</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sites.sp</span>, pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:sites"></span>
<img src="hSDM_files/figure-html/sites-1.png" alt="Location of the 264 10 km\(^2\) quadrats of the Swiss national breeding bird survey. Points are located on a grid of 10 km\(^2\) cells. The grid is covering the geographical extent of the observation points." width="\textwidth"><p class="caption">
Figure 1.2: <strong>Location of the 264 10 km<span class="math inline">\(^2\)</span> quadrats of the Swiss national breeding bird survey.</strong> Points are located on a grid of 10 km<span class="math inline">\(^2\)</span> cells. The grid is covering the geographical extent of the observation points.
</p>
</div>
<p>One important step if we want to account for spatial dependence is to compute the neighborhood for each cell. In our case, the neighborhood is define by the “king move” in chess, in the height directions around the target cell. To compute the neighbordhood for each cell, we need the number of neighbors (which can vary) and the adjacent cell identifiers. We can use the function <code>adjacent</code> from the <code>raster</code> package to do this.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Neighborhood</span></span>
<span><span class="co"># Rasters must be projected to correctly compute the neighborhood</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">'+proj=utm +zone=1'</span></span>
<span><span class="co"># Cell for each site</span></span>
<span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">landscape</span>,<span class="va">sites.sp</span>,cell<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Neighborhood matrix</span></span>
<span><span class="va">ncells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span></span>
<span><span class="va">neighbors.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/adjacent.html" class="external-link">adjacent</a></span><span class="op">(</span><span class="va">landscape</span>, cells<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ncells</span><span class="op">)</span>, directions<span class="op">=</span><span class="fl">8</span>,</span>
<span>                          pairs<span class="op">=</span><span class="cn">TRUE</span>, sorted<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Number of neighbors by cell</span></span>
<span><span class="va">n.neighbors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">neighbors.mat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Adjacent cells</span></span>
<span><span class="va">adj</span> <span class="op">&lt;-</span> <span class="va">neighbors.mat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>We rearrange the data in two data-sets, one for the observation (or detection) process and one for the suitability (or ecological) process. The data for the observation process is in “long” format. Each row is an observation which is characterized by the site number and the julian date of the observation. The data for the suitability process (at the site level) includes information on sites (coordinates and elevation) by row.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Arranging data</span></span>
<span><span class="co"># data.obs</span></span>
<span><span class="va">nsite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">coordx</span><span class="op">)</span></span>
<span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">count1</span>,<span class="va">data.Kery2010</span><span class="op">$</span><span class="va">count2</span>,<span class="va">data.Kery2010</span><span class="op">$</span><span class="va">count3</span><span class="op">)</span></span>
<span><span class="va">juldate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate1</span>,<span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate2</span>,</span>
<span>             <span class="va">data.Kery2010</span><span class="op">$</span><span class="va">juldate3</span><span class="op">)</span></span>
<span><span class="va">site</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nsite</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">data.obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">count</span>,<span class="va">juldate</span>,<span class="va">site</span><span class="op">)</span></span>
<span><span class="va">data.obs</span> <span class="op">&lt;-</span> <span class="va">data.obs</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data.obs</span><span class="op">$</span><span class="va">juldate</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="co"># data.suit</span></span>
<span><span class="va">data.suit</span> <span class="op">&lt;-</span> <span class="va">data.Kery2010</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coordx"</span>,<span class="st">"coordy"</span>,<span class="st">"elevation"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">data.suit</span><span class="op">$</span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="va">cells</span></span>
<span><span class="va">data.suit</span> <span class="op">&lt;-</span> <span class="va">data.suit</span><span class="op">[</span><span class="op">-</span><span class="fl">139</span>,<span class="op">]</span> <span class="co"># Removing site 139 with no juldate</span></span></code></pre></div>
<p>We will compare three SDMs with increasing complexity: a first simple Poisson model, a second N-mixture model with imperfect detection, and a third N-mixture iCAR model with imperfect detection and spatial dependence.</p>
</div>
<div class="section level2" number="2">
<h2 id="simple-poisson-model">
<span class="header-section-number">2</span> Simple Poisson model<a class="anchor" aria-label="anchor" href="#simple-poisson-model"></a>
</h2>
<p>To fit a simple Poisson model, we use the function <code>hSDM.poisson</code>. For this model, we slightly rearrange the observation data-set to associate the site altitude to each observation in a “long” format. The statistical model can be written as follow:</p>
<p><span class="math display">\[\begin{equation}
    y_i \sim \mathcal{P}oisson(\lambda_i) \\
    \log(\lambda_i) = X_i \beta \\
\end{equation}\]</span></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hSDM.poisson</span></span>
<span><span class="va">data.pois</span> <span class="op">&lt;-</span> <span class="va">data.obs</span></span>
<span><span class="va">data.pois</span><span class="op">$</span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="va">data.suit</span><span class="op">$</span><span class="va">elevation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data.obs</span><span class="op">$</span><span class="va">site</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">mod.Kery2010.pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hSDM.poisson.html">hSDM.poisson</a></span><span class="op">(</span>counts<span class="op">=</span><span class="va">data.pois</span><span class="op">$</span><span class="va">count</span>,</span>
<span>                                  suitability<span class="op">=</span><span class="op">~</span><span class="va">elevation</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">elevation</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                  data<span class="op">=</span><span class="va">data.pois</span>, beta.start<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **********:10.0%, mean accept. rates= beta:0.473</span></span>
<span><span class="co">#&gt; **********:20.0%, mean accept. rates= beta:0.437</span></span>
<span><span class="co">#&gt; **********:30.0%, mean accept. rates= beta:0.460</span></span>
<span><span class="co">#&gt; **********:40.0%, mean accept. rates= beta:0.430</span></span>
<span><span class="co">#&gt; **********:50.0%, mean accept. rates= beta:0.430</span></span>
<span><span class="co">#&gt; **********:60.0%, mean accept. rates= beta:0.443</span></span>
<span><span class="co">#&gt; **********:70.0%, mean accept. rates= beta:0.470</span></span>
<span><span class="co">#&gt; **********:80.0%, mean accept. rates= beta:0.443</span></span>
<span><span class="co">#&gt; **********:90.0%, mean accept. rates= beta:0.413</span></span>
<span><span class="co">#&gt; **********:100.0%, mean accept. rates= beta:0.463</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.Kery2010.pois</span><span class="op">$</span><span class="va">mcmc</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations = 5001:14991</span></span>
<span><span class="co">#&gt; Thinning interval = 10 </span></span>
<span><span class="co">#&gt; Number of chains = 1 </span></span>
<span><span class="co">#&gt; Sample size per chain = 1000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                           Mean      SD Naive SE Time-series SE</span></span>
<span><span class="co">#&gt; beta.(Intercept)       0.02908 0.06369 0.002014       0.003676</span></span>
<span><span class="co">#&gt; beta.elevation         3.07617 0.16616 0.005254       0.018741</span></span>
<span><span class="co">#&gt; beta.I(elevation^2)   -1.79461 0.11144 0.003524       0.011860</span></span>
<span><span class="co">#&gt; Deviance            2157.97699 2.35949 0.074614       0.137429</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                           2.5%        25%        50%       75%     97.5%</span></span>
<span><span class="co">#&gt; beta.(Intercept)      -0.09654   -0.01742    0.02864    0.0744    0.1528</span></span>
<span><span class="co">#&gt; beta.elevation         2.76477    2.95534    3.07390    3.1958    3.3890</span></span>
<span><span class="co">#&gt; beta.I(elevation^2)   -2.02038   -1.87021   -1.79278   -1.7178   -1.5802</span></span>
<span><span class="co">#&gt; Deviance            2155.19872 2156.26439 2157.38672 2159.0371 2164.2946</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predictions</span></span>
<span><span class="va">npred</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">nsamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mod.Kery2010.pois</span><span class="op">$</span><span class="va">mcmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Abundance-elevation</span></span>
<span><span class="va">elev.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">3000</span>,length.out<span class="op">=</span><span class="va">npred</span><span class="op">)</span></span>
<span><span class="va">elev.seq.n</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">elev.seq</span><span class="op">-</span><span class="va">elev.mean</span><span class="op">)</span><span class="op">/</span><span class="va">elev.sd</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mod.Kery2010.pois</span><span class="op">$</span><span class="va">mcmc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tbeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">npred</span><span class="op">)</span>,<span class="va">elev.seq.n</span>,<span class="va">elev.seq.n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">nsamp</span>,ncol<span class="op">=</span><span class="va">npred</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">npred</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">tbeta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">N.est.pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">N.q1.pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">N.q2.pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.975</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="3">
<h2 id="n-mixture-model-for-imperfect-detection">
<span class="header-section-number">3</span> N-mixture model for imperfect detection<a class="anchor" aria-label="anchor" href="#n-mixture-model-for-imperfect-detection"></a>
</h2>
<p>The model integrates two processes, an <em>ecological</em> process associated to the abundance of the
species due to habitat suitability and an <em>observation</em> process that takes into account the fact that the probability of detection of the species is inferior to one.</p>
<p><span class="math display">\[\begin{equation}
    \textbf{Ecological process:} \\
    N_i \sim \mathcal{P}oisson(\lambda_i) \\
    \log(\lambda_i) = X_i \beta \\
    ~ \\
    \textbf{Observation process:} \\
    y_{it} \sim \mathcal{B}inomial(N_i, \delta_{it}) \\
    \text{logit}(\delta_{it}) = W_{it} \gamma \\
\end{equation}\]</span></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hSDM.Nmixture</span></span>
<span><span class="va">mod.Kery2010.Nmix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hSDM.Nmixture.html">hSDM.Nmixture</a></span><span class="op">(</span><span class="co"># Observations</span></span>
<span>                     counts<span class="op">=</span><span class="va">data.obs</span><span class="op">$</span><span class="va">count</span>,</span>
<span>                     observability<span class="op">=</span><span class="op">~</span><span class="va">juldate</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">juldate</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                     site<span class="op">=</span><span class="va">data.obs</span><span class="op">$</span><span class="va">site</span>,</span>
<span>                     data.observability<span class="op">=</span><span class="va">data.obs</span>,</span>
<span>                     <span class="co"># Habitat</span></span>
<span>                     suitability<span class="op">=</span><span class="op">~</span><span class="va">elevation</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">elevation</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                     data.suitability<span class="op">=</span><span class="va">data.suit</span>,</span>
<span>                     <span class="co"># Predictions</span></span>
<span>                     suitability.pred<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                     <span class="co"># Chains</span></span>
<span>                     burnin<span class="op">=</span><span class="fl">10000</span>, mcmc<span class="op">=</span><span class="fl">5000</span>, thin<span class="op">=</span><span class="fl">5</span>,</span>
<span>                     <span class="co"># Starting values</span></span>
<span>                     beta.start<span class="op">=</span><span class="fl">0</span>,</span>
<span>                     gamma.start<span class="op">=</span><span class="fl">0</span>,</span>
<span>                     <span class="co"># Priors</span></span>
<span>                     mubeta<span class="op">=</span><span class="fl">0</span>, Vbeta<span class="op">=</span><span class="fl">1.0E6</span>,</span>
<span>                     mugamma<span class="op">=</span><span class="fl">0</span>, Vgamma<span class="op">=</span><span class="fl">1.0E6</span>,</span>
<span>                     <span class="co"># Various</span></span>
<span>                     seed<span class="op">=</span><span class="fl">1234</span>, verbose<span class="op">=</span><span class="fl">1</span>,</span>
<span>                     save.p<span class="op">=</span><span class="fl">0</span>, save.N<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **********:10.0%, mean accept. rates= beta:0.213, gamma:0.253, N:0.172</span></span>
<span><span class="co">#&gt; **********:20.0%, mean accept. rates= beta:0.240, gamma:0.230, N:0.205</span></span>
<span><span class="co">#&gt; **********:30.0%, mean accept. rates= beta:0.240, gamma:0.247, N:0.183</span></span>
<span><span class="co">#&gt; **********:40.0%, mean accept. rates= beta:0.270, gamma:0.250, N:0.193</span></span>
<span><span class="co">#&gt; **********:50.0%, mean accept. rates= beta:0.327, gamma:0.233, N:0.189</span></span>
<span><span class="co">#&gt; **********:60.0%, mean accept. rates= beta:0.313, gamma:0.263, N:0.197</span></span>
<span><span class="co">#&gt; **********:70.0%, mean accept. rates= beta:0.273, gamma:0.223, N:0.211</span></span>
<span><span class="co">#&gt; **********:80.0%, mean accept. rates= beta:0.257, gamma:0.240, N:0.218</span></span>
<span><span class="co">#&gt; **********:90.0%, mean accept. rates= beta:0.310, gamma:0.300, N:0.168</span></span>
<span><span class="co">#&gt; **********:100.0%, mean accept. rates= beta:0.257, gamma:0.230, N:0.206</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Outputs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix</span><span class="op">$</span><span class="va">mcmc</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations = 10001:14996</span></span>
<span><span class="co">#&gt; Thinning interval = 5 </span></span>
<span><span class="co">#&gt; Number of chains = 1 </span></span>
<span><span class="co">#&gt; Sample size per chain = 1000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                          Mean       SD Naive SE Time-series SE</span></span>
<span><span class="co">#&gt; beta.(Intercept)       0.6484  0.08698 0.002750       0.007622</span></span>
<span><span class="co">#&gt; beta.elevation         2.9294  0.20188 0.006384       0.031113</span></span>
<span><span class="co">#&gt; beta.I(elevation^2)   -1.8782  0.13632 0.004311       0.019594</span></span>
<span><span class="co">#&gt; gamma.(Intercept)      0.2419  0.10853 0.003432       0.009402</span></span>
<span><span class="co">#&gt; gamma.juldate         -0.2356  0.08556 0.002706       0.004650</span></span>
<span><span class="co">#&gt; gamma.I(juldate^2)     0.2705  0.08694 0.002749       0.006721</span></span>
<span><span class="co">#&gt; Deviance            1889.7198 29.49971 0.932863       2.417696</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                           2.5%       25%       50%       75%      97.5%</span></span>
<span><span class="co">#&gt; beta.(Intercept)       0.47179    0.5895    0.6484    0.7112    0.80779</span></span>
<span><span class="co">#&gt; beta.elevation         2.52078    2.7878    2.9250    3.0673    3.30330</span></span>
<span><span class="co">#&gt; beta.I(elevation^2)   -2.14580   -1.9673   -1.8808   -1.7859   -1.59867</span></span>
<span><span class="co">#&gt; gamma.(Intercept)      0.02988    0.1652    0.2435    0.3228    0.45101</span></span>
<span><span class="co">#&gt; gamma.juldate         -0.41117   -0.2907   -0.2347   -0.1766   -0.07425</span></span>
<span><span class="co">#&gt; gamma.I(juldate^2)     0.10274    0.2137    0.2704    0.3317    0.43780</span></span>
<span><span class="co">#&gt; Deviance            1837.06422 1868.9839 1887.4536 1907.9318 1954.82932</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predictions</span></span>
<span><span class="va">nsamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix</span><span class="op">$</span><span class="va">mcmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Abundance-elevation</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix</span><span class="op">$</span><span class="va">mcmc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tbeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">nsamp</span>,ncol<span class="op">=</span><span class="va">npred</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">npred</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">tbeta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">N.est.Nmix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">N.q1.Nmix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">N.q2.Nmix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="co"># Detection-Julian date</span></span>
<span><span class="va">juldate.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">200</span>,length.out<span class="op">=</span><span class="va">npred</span><span class="op">)</span></span>
<span><span class="va">juldate.seq.n</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">juldate.seq</span><span class="op">-</span><span class="va">juldate.mean</span><span class="op">)</span><span class="op">/</span><span class="va">juldate.sd</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix</span><span class="op">$</span><span class="va">mcmc</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tgamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">npred</span><span class="op">)</span>,<span class="va">juldate.seq.n</span>,<span class="va">juldate.seq.n</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">nsamp</span>,ncol<span class="op">=</span><span class="va">npred</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">npred</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">delta</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logit.html">inv.logit</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">tgamma</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">delta.est.Nmix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">delta</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">delta.q1.Nmix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">delta</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">delta.q2.Nmix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">delta</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.975</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="4">
<h2 id="n-mixture-model-with-icar-process">
<span class="header-section-number">4</span> N-mixture model with iCAR process<a class="anchor" aria-label="anchor" href="#n-mixture-model-with-icar-process"></a>
</h2>
<p>For this model, we assume that the abundance of the species at one site depends on the abundance of the species on neighboring sites. In this model, the <em>ecological</em> process includes an intrinsic conditional autoregressive (iCAR) subprocess to model the spatial dependence between observations.</p>
<p><span class="math display">\[\begin{equation}
    \textbf{Ecological process:} \\
    N_i \sim \mathcal{P}oisson(\lambda_i) \\
    \log(\lambda_i) = X_i \beta + \rho_{j(i)} \\
    \text{$\rho_{j(i)}$: spatial random effect for spatial entity $j$ including site $i$} \\
    ~ \\
    \textbf{Spatial dependence:} \\
    \text{An intrinsic conditional autoregressive model (iCAR) is assumed:} \\
    \rho_j \sim \mathcal{N}ormal(\mu_j, V_{\rho}/n_j) \\
    \text{$\mu_j$: mean of $\rho_{j^{\prime}}$ in the neighborhood of $j$.} \\
    \text{$V_{\rho}$: variance of the spatial random effects.} \\
    \text{$n_j$: number of neighbors for spatial entity $j$.} \\
    ~ \\
    \textbf{Observation process:} \\
    y_{it} \sim \mathcal{B}inomial(N_i, \delta_{it}) \\
    \text{logit}(\delta_{it}) = W_{it} \gamma \\
\end{equation}\]</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hSDM.Nmixture.iCAR</span></span>
<span><span class="va">mod.Kery2010.Nmix.iCAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hSDM.Nmixture.iCAR.html">hSDM.Nmixture.iCAR</a></span><span class="op">(</span><span class="co"># Observations</span></span>
<span>                            counts<span class="op">=</span><span class="va">data.obs</span><span class="op">$</span><span class="va">count</span>,</span>
<span>                            observability<span class="op">=</span><span class="op">~</span><span class="va">juldate</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">juldate</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                            site<span class="op">=</span><span class="va">data.obs</span><span class="op">$</span><span class="va">site</span>,</span>
<span>                            data.observability<span class="op">=</span><span class="va">data.obs</span>,</span>
<span>                            <span class="co"># Habitat</span></span>
<span>                            suitability<span class="op">=</span><span class="op">~</span><span class="va">elevation</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">elevation</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                            data.suitability<span class="op">=</span><span class="va">data.suit</span>,</span>
<span>                            <span class="co"># Spatial structure</span></span>
<span>                            spatial.entity<span class="op">=</span><span class="va">data.suit</span><span class="op">$</span><span class="va">cells</span>,</span>
<span>                            n.neighbors<span class="op">=</span><span class="va">n.neighbors</span>, neighbors<span class="op">=</span><span class="va">adj</span>,</span>
<span>                            <span class="co"># Chains</span></span>
<span>                            burnin<span class="op">=</span><span class="fl">20000</span>, mcmc<span class="op">=</span><span class="fl">10000</span>, thin<span class="op">=</span><span class="fl">10</span>,</span>
<span>                            <span class="co"># Starting values</span></span>
<span>                            beta.start<span class="op">=</span><span class="fl">0</span>,</span>
<span>                            gamma.start<span class="op">=</span><span class="fl">0</span>,</span>
<span>                            Vrho.start<span class="op">=</span><span class="fl">1</span>,</span>
<span>                            <span class="co"># Priors</span></span>
<span>                            mubeta<span class="op">=</span><span class="fl">0</span>, Vbeta<span class="op">=</span><span class="fl">1.0E6</span>,</span>
<span>                            mugamma<span class="op">=</span><span class="fl">0</span>, Vgamma<span class="op">=</span><span class="fl">1.0E6</span>,</span>
<span>                            priorVrho<span class="op">=</span><span class="st">"1/Gamma"</span>,</span>
<span>                            shape<span class="op">=</span><span class="fl">1</span>, rate<span class="op">=</span><span class="fl">1</span>,</span>
<span>                            <span class="co"># Various</span></span>
<span>                            seed<span class="op">=</span><span class="fl">1234</span>, verbose<span class="op">=</span><span class="fl">1</span>,</span>
<span>                            save.rho<span class="op">=</span><span class="fl">0</span>, save.p<span class="op">=</span><span class="fl">0</span>, save.N<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running the Gibbs sampler. It may be long, please keep cool :)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **********:10.0%, mean accept. rates= beta:0.263, gamma:0.257, rho:0.257, N:0.279</span></span>
<span><span class="co">#&gt; **********:20.0%, mean accept. rates= beta:0.270, gamma:0.253, rho:0.250, N:0.232</span></span>
<span><span class="co">#&gt; **********:30.0%, mean accept. rates= beta:0.260, gamma:0.263, rho:0.283, N:0.251</span></span>
<span><span class="co">#&gt; **********:40.0%, mean accept. rates= beta:0.237, gamma:0.277, rho:0.253, N:0.249</span></span>
<span><span class="co">#&gt; **********:50.0%, mean accept. rates= beta:0.270, gamma:0.290, rho:0.252, N:0.232</span></span>
<span><span class="co">#&gt; **********:60.0%, mean accept. rates= beta:0.253, gamma:0.297, rho:0.280, N:0.234</span></span>
<span><span class="co">#&gt; **********:70.0%, mean accept. rates= beta:0.313, gamma:0.297, rho:0.254, N:0.285</span></span>
<span><span class="co">#&gt; **********:80.0%, mean accept. rates= beta:0.283, gamma:0.250, rho:0.281, N:0.279</span></span>
<span><span class="co">#&gt; **********:90.0%, mean accept. rates= beta:0.323, gamma:0.250, rho:0.289, N:0.236</span></span>
<span><span class="co">#&gt; **********:100.0%, mean accept. rates= beta:0.287, gamma:0.273, rho:0.275, N:0.248</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix.iCAR</span><span class="op">$</span><span class="va">mcmc</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations = 20001:29991</span></span>
<span><span class="co">#&gt; Thinning interval = 10 </span></span>
<span><span class="co">#&gt; Number of chains = 1 </span></span>
<span><span class="co">#&gt; Sample size per chain = 1000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                          Mean       SD Naive SE Time-series SE</span></span>
<span><span class="co">#&gt; beta.(Intercept)       0.3749  0.32613 0.010313       0.040265</span></span>
<span><span class="co">#&gt; beta.elevation         1.9973  0.84697 0.026784       0.279847</span></span>
<span><span class="co">#&gt; beta.I(elevation^2)   -2.1986  0.48710 0.015403       0.142238</span></span>
<span><span class="co">#&gt; gamma.(Intercept)     -0.8790  0.20105 0.006358       0.062329</span></span>
<span><span class="co">#&gt; gamma.juldate         -0.1735  0.06543 0.002069       0.003898</span></span>
<span><span class="co">#&gt; gamma.I(juldate^2)     0.1589  0.05885 0.001861       0.004153</span></span>
<span><span class="co">#&gt; Vrho                  18.1555  4.97802 0.157419       0.547617</span></span>
<span><span class="co">#&gt; Deviance            1336.0869 48.14174 1.522376       9.021355</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                           2.5%       25%       50%       75%      97.5%</span></span>
<span><span class="co">#&gt; beta.(Intercept)      -0.20728    0.1364    0.3661    0.6001    1.02133</span></span>
<span><span class="co">#&gt; beta.elevation         0.62581    1.2987    1.8709    2.6526    3.65104</span></span>
<span><span class="co">#&gt; beta.I(elevation^2)   -3.32975   -2.5131   -2.1079   -1.8235   -1.45366</span></span>
<span><span class="co">#&gt; gamma.(Intercept)     -1.29729   -1.0030   -0.8879   -0.7457   -0.48283</span></span>
<span><span class="co">#&gt; gamma.juldate         -0.29657   -0.2167   -0.1739   -0.1309   -0.04227</span></span>
<span><span class="co">#&gt; gamma.I(juldate^2)     0.04234    0.1187    0.1607    0.1958    0.27203</span></span>
<span><span class="co">#&gt; Vrho                  10.78215   14.6705   17.4504   20.7555   30.86624</span></span>
<span><span class="co">#&gt; Deviance            1248.61524 1302.4338 1334.8412 1368.8538 1430.86366</span></span></code></pre></div>

<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Spatial random effects</span></span>
<span><span class="va">rho.pred</span> <span class="op">&lt;-</span> <span class="va">mod.Kery2010.Nmix.iCAR</span><span class="op">$</span><span class="va">rho.pred</span></span>
<span><span class="va">r.rho.pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span>,<span class="va">rho.pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r.rho.pred</span><span class="op">)</span></span>
<span><span class="co"># Mean abundance by site</span></span>
<span><span class="va">ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">sites.sp</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sites.sp</span>,pch<span class="op">=</span><span class="fl">16</span>,cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sites.sp</span>,pch<span class="op">=</span><span class="fl">1</span>,cex<span class="op">=</span><span class="va">ma</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:Kery2010-Nmix-iCAR-spatial-effects"></span>
<img src="hSDM_files/figure-html/Kery2010-Nmix-iCAR-spatial-effects-1.png" alt="Estimated spatial random effects. Locations of observation quadrats are represented by dots. The mean abundance on each quadrat is represented by a circle of size proportional to abundance." width="\textwidth"><p class="caption">
Figure 4.1: <strong>Estimated spatial random effects.</strong> Locations of observation quadrats are represented by dots. The mean abundance on each quadrat is represented by a circle of size proportional to abundance.
</p>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predictions</span></span>
<span><span class="va">nsamp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix.iCAR</span><span class="op">$</span><span class="va">mcmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Abundance-elevation</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix.iCAR</span><span class="op">$</span><span class="va">mcmc</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tbeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">nsamp</span>,ncol<span class="op">=</span><span class="va">npred</span><span class="op">)</span></span>
<span><span class="co"># Simplified way of obtaining samples for rho</span></span>
<span><span class="va">rho.samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">rho.pred</span>,<span class="va">nsamp</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">npred</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">tbeta</span> <span class="op">+</span> <span class="va">rho.samp</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">N.est.Nmix.iCAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">N.q1.Nmix.iCAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">N.q2.Nmix.iCAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Detection-Julian date</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">mod.Kery2010.Nmix.iCAR</span><span class="op">$</span><span class="va">mcmc</span><span class="op">[</span>,<span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">tgamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">gamma</span><span class="op">)</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="va">nsamp</span>,ncol<span class="op">=</span><span class="va">npred</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">npred</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">delta</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logit.html">inv.logit</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">tgamma</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">delta.est.Nmix.iCAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">delta</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">delta.q1.Nmix.iCAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">delta</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">delta.q2.Nmix.iCAR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">delta</span>,<span class="fl">2</span>,<span class="va">quantile</span>,<span class="fl">0.975</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="5">
<h2 id="comparing-predictions-from-the-three-different-models">
<span class="header-section-number">5</span> Comparing predictions from the three different models<a class="anchor" aria-label="anchor" href="#comparing-predictions-from-the-three-different-models"></a>
</h2>

<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Expected abundance - Elevation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,cex<span class="op">=</span><span class="fl">1.4</span>,tcl<span class="op">=</span><span class="op">+</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elev.seq</span>,<span class="va">N.est.pois</span>,type<span class="op">=</span><span class="st">"l"</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">3000</span><span class="op">)</span>,</span>
<span>     ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>     lwd<span class="op">=</span><span class="fl">2</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Elevation (m a.s.l.)"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Expected abundance"</span>,</span>
<span>     axes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#lines(elev.seq,N.q1.pois,lty=3,lwd=1)</span></span>
<span><span class="co">#lines(elev.seq,N.q2.pois,lty=3,lwd=1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">3000</span>,by<span class="op">=</span><span class="fl">500</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">3000</span>,by<span class="op">=</span><span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,by<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Nmix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">elev.seq</span>,<span class="va">N.est.Nmix</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="co">#lines(elev.seq,N.q1.Nmix,lty=3,lwd=1,col="red")</span></span>
<span><span class="co">#lines(elev.seq,N.q2.Nmix,lty=3,lwd=1,col="red")</span></span>
<span><span class="co"># Nmix.iCAR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">elev.seq</span>,<span class="va">N.est.Nmix.iCAR</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"dark green"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:Kery2010-comp-abundance"></span>
<img src="hSDM_files/figure-html/Kery2010-comp-abundance-1.png" alt="Relationship between abundance and altitude. Black: Poisson model, Red: N-mixture model, Green: N-mixture model with iCAR." width="576"><p class="caption">
Figure 5.1: <strong>Relationship between abundance and altitude.</strong> Black: Poisson model, Red: N-mixture model, Green: N-mixture model with iCAR.
</p>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#lines(elev.seq,N.q1.Nmix.iCAR,lty=3,lwd=1,col="dark green")</span></span>
<span><span class="co">#lines(elev.seq,N.q2.Nmix.iCAR,lty=3,lwd=1,col="dark green")</span></span></code></pre></div>

<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Detection probability - Julian date</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,cex<span class="op">=</span><span class="fl">1.4</span>,tcl<span class="op">=</span><span class="op">+</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">juldate.seq</span>,<span class="va">delta.est.Nmix</span>,type<span class="op">=</span><span class="st">"l"</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">200</span><span class="op">)</span>,</span>
<span>     ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>     lwd<span class="op">=</span><span class="fl">2</span>,</span>
<span>     col<span class="op">=</span><span class="st">"red"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Julian date"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Detection probability"</span>,</span>
<span>     axes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">juldate.seq</span>,<span class="va">delta.q1.Nmix</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">juldate.seq</span>,<span class="va">delta.q2.Nmix</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">200</span>,by<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">200</span>,by<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>,at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Nmix.iCAR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">juldate.seq</span>,<span class="va">delta.est.Nmix.iCAR</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"dark green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">juldate.seq</span>,<span class="va">delta.q1.Nmix.iCAR</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"dark green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">juldate.seq</span>,<span class="va">delta.q2.Nmix.iCAR</span>,lty<span class="op">=</span><span class="fl">3</span>,lwd<span class="op">=</span><span class="fl">1</span>,col<span class="op">=</span><span class="st">"dark green"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:Kery2010-comp-detection"></span>
<img src="hSDM_files/figure-html/Kery2010-comp-detection-1.png" alt="Relationship between detection probability and observation date. Red: N-mixture model, Green: N-mixture model with iCAR." width="576"><p class="caption">
Figure 5.2: <strong>Relationship between detection probability and observation date.</strong> Red: N-mixture model, Green: N-mixture model with iCAR.
</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Clark2007" class="csl-entry">
Clark, J.S. (2007) <em>Models for Ecological Data : An Introduction</em>. Princeton University Press.
</div>
<div id="ref-Flores2009" class="csl-entry">
Flores, O., Rossi, V. &amp; Mortier, F. (2009) Autocorrelation offsets zero-inflation in models of tropical saplings density. <em>Ecological Modelling</em>, <strong>220</strong>, 1797–1809.
</div>
<div id="ref-Kery2010b" class="csl-entry">
Kéry, M. &amp; Andrew Royle, J. (2010) Hierarchical modelling and estimation of abundance and population trends in metapopulation designs. <em>Journal of Animal Ecology</em>, <strong>79</strong>, 453–461.
</div>
<div id="ref-Lahoz-Monfort2014" class="csl-entry">
Lahoz-Monfort, J.J., Guillera-Arroita, G. &amp; Wintle, B.A. (2014) <a href="https://doi.org/10.1111/geb.12138" class="external-link">Imperfect detection impacts the performance of species distribution models</a>. <em>Global Ecology and Biogeography</em>, <strong>23</strong>, 504–515.
</div>
<div id="ref-Latimer2006" class="csl-entry">
Latimer, A.M., Wu, S.S., Gelfand, A.E. &amp; Silander, J.A. (2006) Building statistical models to analyze species distributions. <em>Ecological Applications</em>, <strong>16</strong>, 33–50.
</div>
<div id="ref-Lichstein2002" class="csl-entry">
Lichstein, J.W., Simons, T.R., Shriner, S.A. &amp; Franzreb, K.E. (2002) <span class="nocase">Spatial autocorrelation and autoregressive models in ecology</span>. <em>Ecological Monographs</em>, <strong>72</strong>, 445–463.
</div>
<div id="ref-MacKenzie2002" class="csl-entry">
MacKenzie, D.I., Nichols, J.D., Lachman, G.B., Droege, S., Andrew Royle, J. &amp; Langtimm, C.A. (2002) Estimating site occupancy rates when detection probabilities are less than one. <em>Ecology</em>, <strong>83</strong>, 2248–2255.
</div>
<div id="ref-Royle2004" class="csl-entry">
Royle, J.A. (2004) N-mixture models for estimating population size from spatially replicated counts. <em>Biometrics</em>, <strong>60</strong>, 108–115.
</div>
<div id="ref-Wilson2016" class="csl-entry">
Wilson, A.M. &amp; Jetz, W. (2016) <a href="https://doi.org/10.1371/journal.pbio.1002415" class="external-link">Remotely sensed high-resolution global cloud dynamics for predicting ecosystem and biodiversity distributions</a> ed M. Loreau. <em><span>PLOS</span> Biology</em>, <strong>14</strong>, e1002415.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://ecology.ghislainv.fr" class="external-link">Ghislain Vieilledent</a>, <a href="https://www.cirad.fr" class="external-link"><img src="https://ecology.ghislainv.fr/hSDM/logos/logo-cirad.png"></a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
